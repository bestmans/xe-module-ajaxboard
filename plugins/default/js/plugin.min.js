/*! Copyright (C) 2014 AJAXBOARD. All rights reserved. */!function(e,t){"use strict";e.ajaxboardStorage.connect=!0,t(function(){function n(){this.oApp=e.ajaxboard;var n=this,r=[["events.connect","after","triggerAfterConnect"],["events.insertComment","before","triggerInsertComment"],["events.deleteComment","before","triggerDeleteComment"],["events.insertDocument","before","triggerDispDocumentList"],["events.deleteDocument","before","triggerDispDocumentList"],["events.insertComment","before","triggerDispDocumentList"],["events.deleteComment","before","triggerDispDocumentList"]];t.each(r,function(e,t){n.oApp.insertTrigger(n,t[0],t[1],n[t[2]])})}n.prototype={triggerAfterConnect:function(){var n=this.connect;if(this.connect=!0,n!==!0){var r=this,i=e.completeInsertComment;i&&t.isFunction(i)&&(e.completeInsertComment=function(){r.oApp.clearEditor()}),t(".read_footer").on("click",".btnArea [href]",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var n=e.getQuery("act"),i=e.getQuery("document_srl"),o=r.oApp.current_url.setQuery("act","").setQuery("document_srl","");if("dispBoardDelete"==n){var s=function(e){alert(e.message),location.href=o},c=function(){location.href=o};return r.oApp.deleteDocument(i,e,s,c),!1}}),t("#comment").on("click",".action .delete",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substrin(0,e.indexOf("#")));var n=e.getQuery("comment_srl"),i=function(e){alert(e.message)},o=function(){r.dispCommentList()};return r.oApp.deleteDocument(n,e,i,o),!1}).on("click",".pagination [href]",function(){var e=t(this),n=e.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var i=n.getQuery("cpage");return r.dispCommentListByCpage(i>1&&e.hasClass("direction")?"":i),!1}),t(".list_footer").on("click",".pagination [href]",function(){var e=t(this).attr("href");return e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#"))),r.dispDocumentListByPage(e.getQuery("page")),!1})}},triggerInsertComment:function(e){t("#comment").length&&(t("#comment_"+e.parent_srl).length||t(".read_body [class*='document_"+e.parent_srl+"']").length)&&this.dispCommentList()},triggerDeleteComment:function(e){t("#comment_"+e.target_srl).length&&this.dispCommentList()},triggerDispDocumentList:function(){this.dispDocumentList()},dispCommentList:function(e){var n=this.getPage(e);return n.done(function(e){var n=t("<div>").append(t.parseHTML(e)).find("#comment"),r=n.children(".fbHeader").html(),i=n.children(".fbList").html(),o=n.children(".pagination").html(),s=t("#comment"),c=s.children(".fbHeader"),a=s.children(".fbList"),l=s.children(".pagination");a.length?i||a.remove():c.after(t('<ul class="fbList">')),l.length?o||l.remove():o&&a.after(t('<div class="pagination">')),s.children(".fbHeader").html(r),s.children(".fbList").html(i),s.children(".pagination").html(o)}),n},dispCommentListByCpage:function(e){var t=this,n=this.dispCommentList({cpage:e});return n.done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("cpage",e)}),n},dispDocumentList:function(e){var n=this.getPage(e);return n.done(function(e){var n=t("<div>").append(t.parseHTML(e)).find(".board"),r=n.children(".board_list").html(),i=n.children(".list_footer").children(".pagination").html(),o=t(".board"),s=o.children(".board_list"),c=o.children(".list_footer").children(".pagination");c.length?i||c.remove():i&&t(".list_footer").prepend('<div class="pagination">'),s.html(r),o.children(".list_footer").children(".pagination").html(i)}),n},dispDocumentListByPage:function(e){var t=this,n=this.dispDocumentList({page:e});return n.done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("page",e)}),n},getPage:function(e){return this.oApp.ajax("html",this.oApp.current_url,null,null,e)}};new n})}(this,jQuery);
