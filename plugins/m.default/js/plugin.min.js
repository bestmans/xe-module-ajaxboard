/*! Copyright (C) 2014 AJAXBOARD. All rights reserved. */!function(e,t){"use strict";e.ajaxboardStorage.connect=!0,t(function(){function n(){this.oApp=e.ajaxboard;var n=this,r=[["clearEditor","after","triggerClearEditor"],["events.connect","after","triggerConnect"],["events.insertComment","before","triggerInsertComment"],["events.deleteComment","before","triggerDeleteComment"],["events.insertDocument","before","triggerDispDocumentList"],["events.deleteDocument","before","triggerDispDocumentList"],["events.insertComment","before","triggerDispDocumentList"],["events.deleteComment","before","triggerDispDocumentList"]];t.each(r,function(e,t){n.oApp.insertTrigger(n,t[0],t[1],n[t[2]])})}n.prototype={triggerClearEditor:function(){t("#rText").val("")},triggerConnect:function(){var n=this.connect;if(this.connect=!0,n!==!0){var r=this,i=e.completeInsertComment;i&&t.isFunction(i)&&(e.completeInsertComment=function(){r.oApp.clearEditor()});var o=e.loadPage;o&&t.isFunction(o)&&(e.loadPage=function(e,t){r.oApp.current_url=r.oApp.current_url.setQuery("document_srl",e).setQuery("cpage",t),o(e,t)}),t(".bd").on("click",".auth .de",function(){var e=t(this),n=e.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var i=n.getQuery("comment_srl"),o=function(e){alert(e.message)},s=function(){r.dispComment()};return r.oApp.deleteComment(i,n,o,s),!1}).on("click",".pn .prev, .pn .next",function(){var e=t(this),n=e.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var i=n.getQuery("page");return r.dispDocumentListByPage(i),!1})}},triggerInsertComment:function(e){(t("#cl [class*='comment_"+e.parent_srl+"']").length||t(".co [class*='document_"+e.parent_srl+"']").length)&&this.dispComment()},triggerDeleteComment:function(e){t("#cl [class*='comment_"+e.target_srl+"']").length&&this.dispComment()},triggerDispDocumentList:function(){t(".lt").length&&this.dispDocumentList()},dispComment:function(){if(!t("#clb").length){var n=[];n.push('<div class="hx h3">'),n.push('<h3 id="clb">'+e.xe.lang.cmd_reply+" <em>[1]</em></h3>"),n.push('<button type="button" class="tg tgr" title="open/close"></button>'),n.push("</div>"),t("#skip_co").after(n.join("\n"))}var r=this.oApp.current_url,i=r.getQuery("document_srl"),o=r.getQuery("cpage");return loadPage(i,o)},dispDocumentList:function(e){var n=this.getPage(e);return n.done(function(e){var n=t("<div>").append(t.parseHTML(e)).find(".bd"),r=n.children(".hx").children("h2").html(),i=n.children(".lt").html(),o=n.children(".pn").html(),s=t(".bd"),c=s.children(".hx").children("h2"),u=s.children(".lt"),l=s.children(".pn");c.html(r),u.html(i),l.html(o)}),n},dispDocumentListByPage:function(e){var t=this,n=this.dispDocumentList({page:e});return n.done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("page",e)}),n},getPage:function(e){return this.oApp.ajax("html",this.oApp.current_url,null,null,e)}};new n})}(this,jQuery);
